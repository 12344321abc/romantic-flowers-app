# Журнал архитектурных решений

Этот документ содержит ключевые технические и архитектурные решения, принятые в ходе разработки проекта "Romantic Flower Farm".

## 1. Технологический стек

*   **Бэкенд:** Python 3.12+ с использованием фреймворка FastAPI.
    *   **Причина:** Высокая производительность, современный асинхронный подход, автоматическая генерация документации API, простота в освоении и разработке.
*   **База данных:** SQLite.
    *   **Причина:** Простота в настройке (файловая база данных), не требует отдельного сервера, хорошо подходит для небольших и средних проектов. Для первоначальной разработки и MVP это идеальный выбор.
*   **Фронтенд:** Чистый HTML, CSS, JavaScript.
    *   **Причина:** Максимальная скорость загрузки, отсутствие необходимости в сложных фреймворках для данной задачи, простота интеграции с любым бэкендом.

## 2. Логика жизненного цикла товаров

*   **Продажа партиями:** Цветы продаются не поштучно, а партиями (один сорт, одна поставка).
*   **Автоматическое удаление:** Для поддержания актуальности каталога реализована автоматическая очистка:
    *   Партии со статусом `available` (в наличии) удаляются из базы через **3 недели** после создания.
    *   Партии со статусом `sold` (продано) удаляются из базы через **1 неделю** после продажи.
    *   **Причина:** Цветы — скоропортящийся товар, и на витрине должны быть только свежие и актуальные предложения.

## 3. Работа с базой данных

*   **ORM:** SQLAlchemy используется для взаимодействия с базой данных.
    *   **Причина:** Является стандартом де-факто в мире Python, позволяет описывать модели данных в виде Python-классов, упрощает миграции и запросы.
*   **Создание таблиц:** На этапе разработки таблицы создаются автоматически при старте приложения (`Base.metadata.create_all(bind=engine)`).
    *   **Причина:** Упрощает и ускоряет первоначальную настройку. Для продуктивной среды будет использоваться механизм миграций `Alembic`.

## 4. Клиентская часть и Заказы (Добавлено в итерации 2)

*   **Клиентские аккаунты:**
    *   Реализована система ролей (`admin`, `customer`) в единой таблице `users`.
    *   Клиенты не могут регистрироваться самостоятельно. Их создает и управляет ими Администратор через специальный раздел в админ-панели.
    *   Для клиентов хранятся доп. поля: `contact_name`, `address`, `photo_url`, `admin_notes`.
    *   **Причина:** Это стандартная B2B-модель, обеспечивающая контроль над базой клиентов.

*   **Корзина и Заказы:**
    *   Корзина реализована на стороне клиента (в `localStorage` браузера).
    *   При нажатии "Оформить заказ", содержимое корзины отправляется на сервер. На сервере создаются сущности `Order` и `OrderItem`.
    *   **Причина:** Упрощает архитектуру бэкенда, не требуя хранить тысячи брошенных корзин в базе данных. В БД попадают только оформленные заказы.
    *   Заказ содержит комментарий клиента. Позиция заказа (`OrderItem`) фиксирует цену товара на момент покупки.

*   **Уведомления о заказах:**
    *   После успешного создания заказа в БД, бэкенд отправляет уведомление в Telegram-чат.
    *   **Причина:** Позволяет мгновенно информировать менеджеров о новом заказе без необходимости постоянно проверять админ-панель.